
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Atomist Developer Platform">
      
      
      
        <meta name="author" content="The Atomist Team">
      
      
        <link rel="shortcut icon" href="../../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Command Handlers - The Atomist Documentation</title>
      
    
    
      <script src="../../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../../.." title="The Atomist Documentation" class="md-logo md-header-nav__button">
            <img src="../../../images/atomist-logo-horiz-reversed.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  User Guide
                </span>
              
                <span class="md-header-nav__parent">
                  Rug
                </span>
              
            
            Command Handlers
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/atomist/rug" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Rug
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../../images/atomist-logo-horiz-reversed.svg">
      </i>
    
    The Atomist Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/atomist/rug" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Rug
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../capabilities/" title="Capabilities" class="md-nav__link">
      Capabilities
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/slack/" title="Connect Atomist to Slack" class="md-nav__link">
      Connect Atomist to Slack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/github/" title="Connect Atomist to GitHub" class="md-nav__link">
      Connect Atomist to GitHub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Connect Atomist to CI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Connect Atomist to CI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/ci/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/travis-ci/" title="Travis CI" class="md-nav__link">
      Travis CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/bot/" title="Atomist Bot" class="md-nav__link">
      Atomist Bot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/what-next/" title="What next" class="md-nav__link">
      What next
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/setup-cli/" title="Setup Rug CLI" class="md-nav__link">
      Setup Rug CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/create-rug-project/" title="Create Rug Project" class="md-nav__link">
      Create Rug Project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/setup-typescript/" title="Setup TypeScript" class="md-nav__link">
      Setup TypeScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/publish-rug-project/" title="Publish Rug Project" class="md-nav__link">
      Publish Rug Project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/add-bot-command/" title="Add Bot Command" class="md-nav__link">
      Add Bot Command
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2" checked>
    
    <label class="md-nav__link" for="nav-4-2">
      Rug
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Rug
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event-handlers/" title="Event Handlers" class="md-nav__link">
      Event Handlers
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Command Handlers
      </label>
    
    <a href="./" title="Command Handlers" class="md-nav__link md-nav__link--active">
      Command Handlers
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anatomy-of-a-command-handler" title="Anatomy of a Command Handler" class="md-nav__link">
    Anatomy of a Command Handler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-command-handler" title="Example Command Handler" class="md-nav__link">
    Example Command Handler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declaration" title="Declaration" class="md-nav__link">
    Declaration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intent" title="Intent" class="md-nav__link">
    Intent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery" title="Discovery" class="md-nav__link">
    Discovery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapped-parameters" title="Mapped Parameters" class="md-nav__link">
    Mapped Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commandplans" title="CommandPlans" class="md-nav__link">
    CommandPlans
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#messages" title="Messages" class="md-nav__link">
    Messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directed-messages" title="Directed Messages" class="md-nav__link">
    Directed Messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-messages" title="Response Messages" class="md-nav__link">
    Response Messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respondables" title="Respondables" class="md-nav__link">
    Respondables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instructions" title="Instructions" class="md-nav__link">
    Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rug-functions" title="Rug Functions" class="md-nav__link">
    Rug Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets" title="Secrets" class="md-nav__link">
    Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-handlers" title="Response Handlers" class="md-nav__link">
    Response Handlers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../editors/" title="Editors" class="md-nav__link">
      Editors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../generators/" title="Generators" class="md-nav__link">
      Generators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rug-functions/" title="Rug Functions" class="md-nav__link">
      Rug Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/" title="Secrets" class="md-nav__link">
      Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../path-expressions/" title="Path Expressions" class="md-nav__link">
      Path Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microgrammars/" title="Microgrammars" class="md-nav__link">
      Microgrammars
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templates/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tests/" title="Tests" class="md-nav__link">
      Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../projects/" title="Projects" class="md-nav__link">
      Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../archives/" title="Archives" class="md-nav__link">
      Archives
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lifecycle/" title="Lifecycle" class="md-nav__link">
      Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime/" title="Runtime" class="md-nav__link">
      Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conventions/" title="Conventions" class="md-nav__link">
      Conventions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/slack/" title="Slack" class="md-nav__link">
      Slack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/github/" title="GitHub.com" class="md-nav__link">
      GitHub.com
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/travis-ci/" title="Travis CI" class="md-nav__link">
      Travis CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Interfaces
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Interfaces
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/bot/" title="Bot" class="md-nav__link">
      Bot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-3" type="checkbox" id="nav-4-4-3">
    
    <label class="md-nav__link" for="nav-4-4-3">
      CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-3">
        CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/using-rugs/" title="Using Rugs" class="md-nav__link">
      Using Rugs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/developing-rugs/" title="Developing Rugs" class="md-nav__link">
      Developing Rugs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fingerprints/" title="Fingerprints" class="md-nav__link">
      Fingerprints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../seeds/" title="Seeds" class="md-nav__link">
      Seeds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../spring-agent/" title="Spring Agent" class="md-nav__link">
      Spring Agent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-8" type="checkbox" id="nav-4-8">
    
    <label class="md-nav__link" for="nav-4-8">
      Permissions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-8">
        Permissions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../permissions/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permissions/slack/" title="Slack Scopes" class="md-nav__link">
      Slack Scopes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permissions/github/" title="GitHub Scopes" class="md-nav__link">
      GitHub Scopes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Reference Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Rug
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Rug
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug/extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug/path-expressions/" title="Path Expressions" class="md-nav__link">
      Path Expressions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug-cli/" title="Rug CLI" class="md-nav__link">
      Rug CLI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anatomy-of-a-command-handler" title="Anatomy of a Command Handler" class="md-nav__link">
    Anatomy of a Command Handler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-command-handler" title="Example Command Handler" class="md-nav__link">
    Example Command Handler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declaration" title="Declaration" class="md-nav__link">
    Declaration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intent" title="Intent" class="md-nav__link">
    Intent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery" title="Discovery" class="md-nav__link">
    Discovery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapped-parameters" title="Mapped Parameters" class="md-nav__link">
    Mapped Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commandplans" title="CommandPlans" class="md-nav__link">
    CommandPlans
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#messages" title="Messages" class="md-nav__link">
    Messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directed-messages" title="Directed Messages" class="md-nav__link">
    Directed Messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-messages" title="Response Messages" class="md-nav__link">
    Response Messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respondables" title="Respondables" class="md-nav__link">
    Respondables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instructions" title="Instructions" class="md-nav__link">
    Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rug-functions" title="Rug Functions" class="md-nav__link">
    Rug Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets" title="Secrets" class="md-nav__link">
    Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-handlers" title="Response Handlers" class="md-nav__link">
    Response Handlers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Command Handlers</h1>
                
                <p>Lowering the barrier for communication and information flow makes
teams more productive. Open Source projects have long relied on chat
to help them operate and coordinate contributors and project lifecycle.
Modern chat solutions such as Slack, which can integrate deeply in your ecosystem,
have improved on those foundations and have proven to be fantastic hubs for teams
to drive automation with simple chat commands.</p>
<p>Common scenarios, for instance cutting a new release, or rolling back a broken
deployment. Additionally, like other Rugs,  command handlers can also dive into
the code of project as a result of a bot interaction. In other words, not only
can you use Rug commands to list open issues on a project but the team can also
query the project&rsquo;s code or even run other Rugs against the project, all of this
from the project&rsquo;s chat channel.</p>
<h2 id="anatomy-of-a-command-handler">Anatomy of a Command Handler<a class="headerlink" href="#anatomy-of-a-command-handler" title="Permanent link">&para;</a></h2>
<p>Rug commands handlers are the interface to add new skills to the <a href="../../interfaces/bot/">Atomist bot</a>.
These handlers are appropriate when you want to either query your project
or perform an action where your team communicates about the project.</p>
<p>Chat commands are declared in Rug command handlers. Command handlers handle
commands coming from users via the Atomist bot.</p>
<p>Depending on their goal, Rug command handler implementations are stored either alongside
the project they target or in different projects altogether.</p>
<p>Below is the basic structure of any Rug project, except that our handlers live in
the <code>.atomist/handlers</code> directory:</p>
<div class="codehilite"><pre><span></span><span class="go">~/workspace/team-handlers</span>
<span class="go">    ├── .atomist</span>
<span class="go">    │   ├── .gitignore</span>
<span class="go">    │   ├── handlers</span>
<span class="go">    │   │   ├── command</span>
<span class="go">    │   │   │   └── MergePR.ts</span>
<span class="go">    │   │   └── event</span>
<span class="go">    │   │   │   └── GitHubCommit.ts</span>
<span class="go">    │   ├── package.json</span>
<span class="go">    │   ├── tests</span>
<span class="go">    │   └── tsconfig.json</span>
<span class="go">    ├── CHANGELOG.md</span>
<span class="go">    ├── .gitignore</span>
<span class="go">    ├── LICENSE</span>
<span class="go">    └── README.md</span>
</pre></div>

<p>The remaining files and directors of this Rug follows the usual
<a href="../projects/">Rug project</a> structure.</p>
<h2 id="example-command-handler">Example Command Handler<a class="headerlink" href="#example-command-handler" title="Permanent link">&para;</a></h2>
<p>Suppose we want to open a new GitHub issue:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Issue</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/cortex/Issue&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span>
    <span class="nx">CommandHandler</span><span class="p">,</span> <span class="nx">Intent</span><span class="p">,</span> <span class="nx">MappedParameter</span><span class="p">,</span> <span class="nx">Parameter</span><span class="p">,</span> <span class="nx">Secrets</span><span class="p">,</span> <span class="nx">Tags</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/operations/Decorators&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span>
    <span class="nx">CommandPlan</span><span class="p">,</span> <span class="nx">CommandRespondable</span><span class="p">,</span> <span class="nx">Execute</span><span class="p">,</span> <span class="nx">HandleCommand</span><span class="p">,</span> <span class="nx">HandlerContext</span><span class="p">,</span>
    <span class="nx">MappedParameters</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/operations/Handlers&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">handleErrors</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rugs/operations/CommonHandlers&quot;</span><span class="p">;</span>

<span class="kd">@CommandHandler</span><span class="p">(</span><span class="s2">&quot;CreateGitHubIssue&quot;</span><span class="p">,</span> <span class="s2">&quot;Create an issue on GitHub&quot;</span><span class="p">)</span>
<span class="kd">@Tags</span><span class="p">(</span><span class="s2">&quot;github&quot;</span><span class="p">,</span> <span class="s2">&quot;issues&quot;</span><span class="p">)</span>
<span class="kd">@Secrets</span><span class="p">(</span><span class="s2">&quot;github://user_token?scopes=repo&quot;</span><span class="p">)</span>
<span class="kd">@Intent</span><span class="p">(</span><span class="s2">&quot;create issue&quot;</span><span class="p">)</span>
<span class="kr">class</span> <span class="nx">CreateIssueCommand</span> <span class="kr">implements</span> <span class="nx">HandleCommand</span> <span class="p">{</span>

    <span class="kd">@Parameter</span><span class="p">({</span> <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;The issue title&quot;</span><span class="p">,</span> <span class="nx">pattern</span><span class="o">:</span> <span class="s2">&quot;^.*$&quot;</span> <span class="p">})</span>
    <span class="kr">public</span> <span class="nx">title</span>: <span class="kt">string</span><span class="p">;</span>

    <span class="kd">@Parameter</span><span class="p">({</span> <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;The issue body&quot;</span><span class="p">,</span> <span class="nx">pattern</span><span class="o">:</span> <span class="s2">&quot;^.*(?m)$&quot;</span> <span class="p">})</span>
    <span class="kr">public</span> <span class="nx">body</span>: <span class="kt">string</span><span class="p">;</span>

    <span class="kd">@MappedParameter</span><span class="p">(</span><span class="nx">MappedParameters</span><span class="p">.</span><span class="nx">GITHUB_REPOSITORY</span><span class="p">)</span>
    <span class="kr">public</span> <span class="nx">repo</span>: <span class="kt">string</span><span class="p">;</span>

    <span class="kd">@MappedParameter</span><span class="p">(</span><span class="nx">MappedParameters</span><span class="p">.</span><span class="nx">GITHUB_REPO_OWNER</span><span class="p">)</span>
    <span class="kr">public</span> <span class="nx">owner</span>: <span class="kt">string</span><span class="p">;</span>

    <span class="kd">@MappedParameter</span><span class="p">(</span><span class="s2">&quot;atomist://correlation_id&quot;</span><span class="p">)</span>
    <span class="kr">public</span> <span class="nx">corrid</span>: <span class="kt">string</span><span class="p">;</span>

    <span class="kr">public</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">ctx</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">plan</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CommandPlan</span><span class="p">();</span>
        <span class="kr">const</span> <span class="nx">execute</span>: <span class="kt">CommandRespondable</span><span class="o">&lt;</span><span class="nx">Execute</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">instruction</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;execute&quot;</span><span class="p">,</span>
                <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;create-github-issue&quot;</span><span class="p">,</span>
                <span class="nx">parameters</span>: <span class="kt">this</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">};</span>
        <span class="nx">plan</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">handleErrors</span><span class="p">(</span><span class="nx">execute</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">plan</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">create</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CreateIssueCommand</span><span class="p">();</span>
</pre></div>
</td></tr></table>

<p>This command handler follows the same programming model as other Rugs, so it
should look familiar.</p>
<h3 id="declaration">Declaration<a class="headerlink" href="#declaration" title="Permanent link">&para;</a></h3>
<p>The first lines group the Rug typing imports which, provide interfaces and
decorators to implement and declare your handlers. The  <code class="codehilite"><span class="nx">CreateIssueCommand</span></code>
class expresses how the command is invoked, as well as how to handle the error
scenario. <code class="codehilite"><span class="nx">GenericErrorHandler</span></code> is a  <a href="#response-handlers">Response Handlers</a>
to handle the failure case of the <code>create-github-issue</code> <code>execute</code> <a href="#instructions">instruction</a>.</p>
<p>We declare our handler through <a href="https://www.typescriptlang.org/docs/handbook/decorators.html">decorators</a>. The first argument
of the <code class="codehilite"><span class="kd">@CommandHandler</span></code> decorator is the name of the command,
the second is its description. These make the handlers visible and discoverable.</p>
<h3 id="intent">Intent<a class="headerlink" href="#intent" title="Permanent link">&para;</a></h3>
<p>A Rug command handler can have associated intent that users can send when talking
with the Atomist bot. The intent is described using the <code class="codehilite"><span class="kd">@Intent</span></code>
decorator (line 20). Whenever a user sends the <code>@atomist create issue</code> message
to the Atomist bot, the Rug runtime runs the <code class="codehilite"><span class="nx">CreateGitHubIssue</span></code>
command handler. Declaring Intent is the way we declare the commands that are
made availble to users in chat.</p>
<div class="admonition note">
<p class="admonition-title">Command Handlers invoking Command Handlers</p>
<p>Most of the time, it makes sense to add the <code class="codehilite"><span class="kd">@Intent</span></code> decorator.
However, it&rsquo;s also possible to invoke Command Handlers from Command Handlers
by adding them to the Plan (more on this later), so for these handlers, it
might not make sense to expose them directly to chat users as commands.</p>
</div>
<h3 id="discovery">Discovery<a class="headerlink" href="#discovery" title="Permanent link">&para;</a></h3>
<p>All Rugs should be annotated with one or more <code class="codehilite"><span class="kd">@Tags</span></code> 
<a href="https://www.typescriptlang.org/docs/handbook/decorators.html">decorators</a> to optimize their discoverability. For 
example if you were to create an Rug that alters a README file
then the following <code class="codehilite"><span class="kd">@Tags</span></code> would be applicable:</p>
<div class="codehilite"><pre><span></span><span class="kd">@Tags</span><span class="p">(</span><span class="s2">&quot;readme&quot;</span><span class="p">,</span> <span class="s2">&quot;documentation&quot;</span><span class="p">)</span>
</pre></div>

<p>Tag values should consist of only lower case letters, numbers, and
dashes (<code>-</code>).</p>
<p>If possible, try to include at least one of the tags on your Rug maps to an image
for a nicer rendering.  The following tags currently have images:
<code>docker</code>,<code>github</code>, <code>travis-ci</code>, <code>apache</code>, <code>git</code>, <code>spring-boot</code>,
<code>spring</code>, <code>clojure</code>, <code>go</code>, <code>java</code>, <code>python</code>, <code>scala</code>, and
<code>documentation</code>.</p>
<h3 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h3>
<p>You define the class which implements your command handler (line 21). The class is
exported so that it can referenced from unit tests. A command handler implements
the <code class="codehilite"><span class="nx">HandleCommand</span></code> interface. This interface requires the
<code class="codehilite"><span class="nx">handle</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span></code> method to be
implemented. It is a convention for the command handler and the class that defines
it to have the same name.</p>
<p>The <code class="codehilite"><span class="nx">handle</span></code> method takes a single argument, a
<code class="codehilite"><span class="nx">HandlerContext</span></code> instance. This gives you access to a
<a href="../path-expressions/">path expression engine</a> to query your organization&rsquo;s projects. The method
must return a <code class="codehilite"><span class="nx">CommandPlan</span></code>.</p>
<h3 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h3>
<p>Rug command handlers can take parameters like other Rugs. Parameters are declared using the <code class="codehilite"><span class="kd">@Parameter</span></code> decorator. 
The decorated variable names the parameter. If you assign a value to that
variable, it becomes the parameter&rsquo;s default value. The <code class="codehilite"><span class="kd">@Parameter</span></code>
decorator adds additional metadata via a single argument: a JavaScript object
whose properties are documented in the <a href="../conventions/">conventions</a>. Though the only
mandatory property is <code class="codehilite"><span class="nx">pattern</span></code>. It is highly recommended to also
set <code class="codehilite"><span class="nx">description</span></code>, <code class="codehilite"><span class="nx">displayName</span></code> and 
<code class="codehilite"><span class="nx">validInput</span></code> in order to help other users when invoking Rugs via
the Atomist bot.</p>
<h3 id="mapped-parameters">Mapped Parameters<a class="headerlink" href="#mapped-parameters" title="Permanent link">&para;</a></h3>
<p>Rug command handlers can define what are called Mapped Parameters to receive
relevant contextual information when invoked via the Atomist bot. Mapped Parameters, declared using the <code class="codehilite"><span class="kd">@MappedParameter</span></code> decorator, 
behave much like ordinary Parameters declared by the  <code class="codehilite"><span class="kd">@Parameter</span></code> 
decorator, but are defined and provided by an external system, in most cases,
the Atomist Bot itself.</p>
<p>For example, the <code>&quot;atomist://github/repository/owner&quot;</code> Mapped Parameter will be
populated with the name of owner (user or organization) of the GitHub repository
associated with a particular chat channel.</p>
<p>A TypeScript helper class called <code class="codehilite"><span class="nx">MappedParameters</span></code> exists to 
aid discovery and use of Mapped Parameters. It lives in an NPM module at
<code>@atomist/rug/operations/Handlers.ts</code>:</p>
<div class="codehilite"><pre><span></span><span class="kr">abstract</span> <span class="kr">class</span> <span class="nx">MappedParameters</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">readonly</span> <span class="nx">GITHUB_REPO_OWNER</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;atomist://github/repository/owner&quot;</span>
  <span class="kr">static</span> <span class="nx">readonly</span> <span class="nx">GITHUB_REPOSITORY</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;atomist://github/repository&quot;</span>
  <span class="kr">static</span> <span class="nx">readonly</span> <span class="nx">SLACK_CHANNEL</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;atomist://slack/channel&quot;</span>
  <span class="kr">static</span> <span class="nx">readonly</span> <span class="nx">SLACK_TEAM</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;atomist://slack/team&quot;</span>
  <span class="kr">static</span> <span class="nx">readonly</span> <span class="nx">SLACK_USER</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;atomist://slack/user&quot;</span>
  <span class="kr">static</span> <span class="nx">readonly</span> <span class="nx">GITHUB_WEBHOOK_URL</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;atomist://github_webhook_url&quot;</span>
<span class="p">}</span>
</pre></div>

<h3 id="commandplans">CommandPlans<a class="headerlink" href="#commandplans" title="Permanent link">&para;</a></h3>
<p>A <code class="codehilite"><span class="nx">CommandPlan</span></code> describes the actions to be taken by the Rug runtime
on behalf of the handler. CommandPlans are composed of <a href="#messages">Messages</a> and/or
<a href="#respondables">respondables</a>. Respondables instruct the rug runtime to immediately
perform ordinary rug operations, whereas messages are sent to the Atomist Bot for
display to the user.</p>
<h3 id="messages">Messages<a class="headerlink" href="#messages" title="Permanent link">&para;</a></h3>
<p>A <code>Message</code> represents presentable content to be rendered in chat by the Atomist
Bot to a chat channel or user. However, each of the two available message types
achieve this in different ways.</p>
<h4 id="directed-messages">Directed Messages<a class="headerlink" href="#directed-messages" title="Permanent link">&para;</a></h4>
<p>A Directed Message is sent directly to on or more users or channels. No
automatic routing is performed by the Atomist Bot. It&rsquo;s possible to
add Directed Messages to a Plan returned by any handler type.</p>
<p>The simplest use of a Response Message just echos back some plain text to
the user that invoked the command:</p>
<div class="codehilite"><pre><span></span>    <span class="nx">handle</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserAddress</span><span class="p">(</span><span class="s2">&quot;@bob&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">CommandPlan</span><span class="p">.</span><span class="nx">ofMessage</span><span class="p">(</span><span class="k">new</span> <span class="nx">DirectedMessage</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">,</span> <span class="nx">bob</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>

<p>It&rsquo;s possible to add more channels or usernames:</p>
<div class="codehilite"><pre><span></span><span class="nx">handle</span><span class="p">(</span><span class="nx">response</span>: <span class="kt">Response</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserAddress</span><span class="p">(</span><span class="s2">&quot;@bob&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">msg</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">DirectedMessage</span><span class="p">(</span><span class="s2">&quot;Hello everyone!&quot;</span><span class="p">,</span> <span class="nx">bob</span><span class="p">);</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">addAddress</span><span class="p">(</span><span class="k">new</span> <span class="nx">ChannelAddress</span><span class="p">(</span><span class="s2">&quot;#general&quot;</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">CommandPlan</span><span class="p">.</span><span class="nx">ofMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>By default, the body of the message is assumed to be <code>&quot;text/plain</code>, and will be
displayed verbatim. The message can also be JSON formatted according to
<a href="https://api.slack.com/docs/messages/builder">Slack&rsquo;s message standards</a>:</p>
<div class="codehilite"><pre><span></span>    <span class="nx">handle</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserAddress</span><span class="p">(</span><span class="s2">&quot;@bob&quot;</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;I am a test message https://www.atomist.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;attachments&quot;</span><span class="o">:</span> <span class="p">[{</span>
               <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;And here’s an attachment!&quot;</span>
             <span class="p">}]</span>
        <span class="p">}</span>
        <span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DirectedMessage</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">json</span><span class="p">),</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">MessageMimeTypes</span><span class="p">.</span><span class="nx">SLACK_JSON</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">CommandPlan</span><span class="p">.</span><span class="nx">ofMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>

<h4 id="response-messages">Response Messages<a class="headerlink" href="#response-messages" title="Permanent link">&para;</a></h4>
<p>A Response Message is much like a <code class="codehilite"><span class="nx">DirectedMesssage</span></code>, except that
the destination for the message is optional because the Atomist Bot chooses the
channel or user to respond to based on where the command was invoked in the chat
system. As such, it really only makes sense to return Response Messages in Plans
returned from Command Handlers.</p>
<p>The most simple use of a Response Message just echos back some plain text to
the user that invoked the command:</p>
<div class="codehilite"><pre><span></span>    <span class="nx">handle</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">CommandPlan</span><span class="p">.</span><span class="nx">ofMessage</span><span class="p">(</span><span class="k">new</span> <span class="nx">ResponseMessage</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">))</span>
    <span class="p">}</span>
</pre></div>

<p>In addition to the default recipient, we can add one or more
<code class="codehilite"><span class="nx">MessageAddress</span></code>to the message to send the same message to other
chat users or channels.</p>
<div class="codehilite"><pre><span></span><span class="nx">handle</span><span class="p">(</span><span class="nx">response</span>: <span class="kt">Response</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">message</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">ResponseMessage</span><span class="p">(</span><span class="s2">&quot;Hello other world!&quot;</span><span class="p">);</span>
    <span class="nx">message</span><span class="p">.</span><span class="nx">addAddress</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserAddress</span><span class="p">(</span><span class="s2">&quot;@bob&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="nx">CommandPlan</span><span class="p">.</span><span class="nx">ofMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>By default, the body of the message is assumed to be <code>text/plain</code>, and will be
displayed verbatim. The message can also be JSON formatted
according to <a href="https://api.slack.com/docs/messages/builder">Slack&rsquo;s message standards</a>:</p>
<div class="codehilite"><pre><span></span>    <span class="nx">handle</span><span class="p">(</span><span class="nx">command</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;I am a test message https://www.atomist.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;attachments&quot;</span><span class="o">:</span> <span class="p">[{</span>
               <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;And here’s an attachment!&quot;</span>
             <span class="p">}]</span>
        <span class="p">}</span>
        <span class="kr">const</span> <span class="nx">msgg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ResponseMessage</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">,</span> <span class="nx">MessageMimeTypes</span><span class="p">.</span><span class="nx">SLACK_JSON</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">CommandPlan</span><span class="p">.</span><span class="nx">ofMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>

<h3 id="respondables">Respondables<a class="headerlink" href="#respondables" title="Permanent link">&para;</a></h3>
<p>An <code class="codehilite"><span class="nx">CommandRespondable</span></code> is really just a container for an instruction and
some optional <code>onError</code> and <code>onSuccess</code> capabilities. The <code>onError</code> and <code>onSuccess</code>
properties of an <code class="codehilite"><span class="nx">CommandRespondable</span></code> can be <a href="#messages">messages</a>,
<a href="#commandplans">CommandPlans</a> or <a href="#response-handlers">response handlers</a>.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">plan</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CommandPlan</span><span class="p">();</span>
<span class="nx">plan</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="nx">instruction</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;execute&quot;</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;create-github-issue&quot;</span><span class="p">,</span>
            <span class="nx">parameters</span>: <span class="kt">this</span>
        <span class="p">},</span>
        <span class="nx">onError</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;respond&quot;</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;GenericErrorHandler&quot;</span><span class="p">,</span>
            <span class="nx">parameters</span>: <span class="kt">this</span>
        <span class="p">},</span>
        <span class="nx">onSuccess</span>: <span class="kt">new</span> <span class="nx">ResponseMesssage</span><span class="p">(</span><span class="s2">&quot;Successfully created issue&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="nx">plan</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">handleErrors</span><span class="p">(</span><span class="nx">exec</span><span class="p">,</span> <span class="k">this</span><span class="p">))</span>
<span class="k">return</span> <span class="nx">plan</span><span class="p">;</span>
</pre></div>

<p>The example above shows how send a message back to the user or channel that invoked
the command <code>onSuccess</code> or to invoke the <code>GenericErrorHandler</code> <a href="#response-handlers">Response Handler</a>
if creation fails.</p>
<h3 id="instructions">Instructions<a class="headerlink" href="#instructions" title="Permanent link">&para;</a></h3>
<p>Instructions in an <code class="codehilite"><span class="nx">CommandRespondable</span></code> have the following properties:</p>
<ul>
<li><code class="codehilite"><span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;generate&quot;</span> <span class="o">|</span> <span class="s2">&quot;edit&quot;</span> <span class="o">|</span> <span class="s2">&quot;execute&quot;</span> <span class="o">|</span> <span class="s2">&quot;command&quot;</span></code>: the kind of instruction</li>
<li><code class="codehilite"><span class="nx">name</span>: <span class="kt">string</span></code>: the name of the operation to apply</li>
<li><code class="codehilite"><span class="nx">parameters</span><span class="o">:</span> <span class="p">{}</span></code>: key/value pairs passed to the operation</li>
<li><code class="codehilite"><span class="nx">project?</span>: <span class="kt">string</span></code>: Project name (only for generators &amp; editors)</li>
</ul>
<p>Instructions can be used to have the rug runtime run Rugs, such as invoking
a Generator (<code class="codehilite"><span class="s2">&quot;generate&quot;</span></code>), an Editor (<code class="codehilite"><span class="s2">&quot;edit&quot;</span></code>),
a <a href="#rug-functions">Rug Funtion</a> (<code class="codehilite"><span class="s2">&quot;execute&quot;</span></code>) or even another Command
Handler.</p>
<h3 id="rug-functions">Rug Functions<a class="headerlink" href="#rug-functions" title="Permanent link">&para;</a></h3>
<p>Rug Functions, as indicated by their name, are functions that can be invoked
from within Event or Command Handlers. They can be scheduled for invocation by
adding an instruction of kind <code>execute</code> to a plan:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">plan</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="nx">instruction</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;execute&quot;</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
            <span class="nx">parameters</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://api.github.com/repos/atomist/rug&quot;</span><span class="p">,</span>
                <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
                <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Authorization&quot;</span><span class="o">:</span> <span class="sb">`token #{github://user_token?scopes=repo}`</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="nx">body</span>: <span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">createRepoRequest</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">onSuccess</span>: <span class="kt">new</span> <span class="nx">DirectMessage</span><span class="p">(</span><span class="s2">&quot;Woot!&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ChannelAddress</span><span class="p">(</span><span class="s2">&quot;#random&quot;</span><span class="p">)),</span>
        <span class="nx">onError</span>: <span class="kt">new</span> <span class="nx">DirectMessage</span><span class="p">(</span><span class="s2">&quot;Un oh&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ChannelAddress</span><span class="p">(</span><span class="s2">&quot;#random&quot;</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</td></tr></table>

<p>The plan above instructs the Rug Runtime to invoke the <code>http</code> Rug Function,
passing all the <code>parameters</code> to it, and sending appropriate messages to the
<code>#random</code> channel <code>onSuccess</code> or <code>onError</code>.</p>
<p>To use a Rug Function from an Event or Command Handler, its archive&rsquo;s
coordinates must be present in the <code>.atomist.extensions</code> section of
the Rug project&rsquo;s <a href="../archives/" title="Rug Archives"><code>package.json</code></a>.</p>
<div class="admonition danger">
<p class="admonition-title">Security</p>
<p>All Rug Function archives must be signed by Atomist and be explicitly
whitelisted in the Atomist service. Otherwise, the execution of the invoking
handler will be aborted.</p>
</div>
<p><a href="#secrets">Secrets</a> can also be passed to Rug Functions, but currently this is only supported
for Command Handlers.</p>
<p>The special <code>#{&lt;secret path&gt;}</code> notation used above is a way of injecting the value
of a secret (in this case, a GitHub token with <code>repo</code> scope) in to the parameters
to a function via string filtering. Rug Functions can also be <a href="https://github.com/atomist/rug-functions-aws/blob/master/src/main/scala/com/atomist/rug/MirrorRepoToS3.scala#L40">annotated</a>
so that if the secrets required are known in advance, we don&rsquo;t need to use paramter
filtering.</p>
<p>The following Rug Function archives available:</p>
<ul>
<li><a href="https://github.com/atomist/rug-function-http">rug-function-http</a> - perform arbitrary HTTP requests</li>
<li><a href="https://github.com/atomist/rug-functions-travis">rug-functions-travis</a> - encrypt secrets, start/stop builds</li>
<li><a href="https://github.com/atomist/rug-functions-aws">rug-functions-aws</a> - perform s3 operations and so on</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Creating your own Rug functions</p>
<p>Right now there is no support for user-created Rug functions. Please get in
touch by joining our <a href="https://join.atomist.com/">Slack team</a> if you need one
that doesn&rsquo;t already exist.</p>
</div>
<h3 id="secrets">Secrets<a class="headerlink" href="#secrets" title="Permanent link">&para;</a></h3>
<p>Secrets are pieces of sensitive information stored securely by Atomist. Secrets
are used by <a href="../rug-functions/">Rug Functions</a> to provide access
to secured systems, such as the GitHub API.</p>
<p>Handlers that invoke Rug Functions that require secrets must use the
<code class="codehilite"><span class="kd">@Secrets</span></code> decorator to declare to the Rug runtime that those
secrets will be required during the execution of the handler&rsquo;s CommandPlan:</p>
<div class="codehilite"><pre><span></span><span class="p">...</span>
<span class="kd">@Secrets</span><span class="p">(</span><span class="s2">&quot;github://user_token?scopes=repo,read:org&quot;</span><span class="p">)</span>
<span class="kr">class</span> <span class="nx">CloseIssueCommand</span> <span class="kr">implements</span> <span class="nx">HandleCommand</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>

<p>The <code class="codehilite"><span class="kd">@Secrets</span></code> decorator takes a comma separate list of secret
paths. The decorator provides enough context to the Atomist Bot such that it
can initiate the secure collection of the require secret data, such as a GitHub
token collected via OAuth flow.</p>
<div class="admonition success">
<p class="admonition-title">Confidentiality</p>
<p>All sensitive data stored by Atomist are encrypted at rest in
<a href="https://www.vaultproject.io/docs/internals/security.html">Vault</a>.</p>
</div>
<p>There are currently two types of secrets:</p>
<ul>
<li>GitHub tokens: automatically collected by the Atomist Bot<ul>
<li><code class="codehilite"><span class="s2">&quot;github://user_token?scopes=repo&quot;</span></code> - <code>repo</code> scoped user token</li>
<li><code class="codehilite"><span class="s2">&quot;github://team_token?scopes=repo&quot;</span></code> - <code>repo</code> scoped
team token Both user and team GitHub tokens require the scopes
needed by the <a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">token</a> to be provided as a comma-separated list.</li>
</ul>
</li>
<li>Generic Secrets: manual collection<ul>
<li><code class="codehilite"><span class="s2">&quot;secret://user?path=/some/secret&quot;</span></code> - generic user secret</li>
<li><code class="codehilite"><span class="s2">&quot;secret://team?path=/some/secret&quot;</span></code> - generic team secret</li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Generic Secrets</p>
<p>These are currently only available for very specific and mostly internal use
cases as we currently have no secure public mechanism for collecting and storing
them, though this is something we are hoping to support in the near future. They
are mentioned here to avoid any confusion when seen in publically visible Handlers.</p>
</div>
<h3 id="response-handlers">Response Handlers<a class="headerlink" href="#response-handlers" title="Permanent link">&para;</a></h3>
<p>A <code class="codehilite"><span class="nx">Respond</span></code> object (declared using <code class="codehilite"><span class="p">{</span><span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;respond&quot;</span><span class="p">}</span></code>)
indicates the desire to handle the response to an Instruction using a
<code class="codehilite"><span class="nx">ResponseHandler</span></code> object.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span>
    <span class="nx">Parameter</span><span class="p">,</span> <span class="nx">ParseJson</span><span class="p">,</span> <span class="nx">ResponseHandler</span><span class="p">,</span> <span class="nx">Tags</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/operations/Decorators&quot;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span>
    <span class="nx">ChannelAddress</span><span class="p">,</span> <span class="nx">DirectedMessage</span><span class="p">,</span> <span class="nx">EventPlan</span><span class="p">,</span> <span class="nx">HandlerContext</span><span class="p">,</span>
    <span class="nx">HandleResponse</span><span class="p">,</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">ResponseMessage</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/operations/Handlers&quot;</span><span class="p">;</span>

<span class="kd">@ResponseHandler</span><span class="p">(</span><span class="s2">&quot;GenericSuccessHandler&quot;</span><span class="p">,</span> <span class="s2">&quot;displays a success message in chat&quot;</span><span class="p">)</span>
<span class="kd">@Tags</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">class</span> <span class="nx">GenericSuccessHandler</span> <span class="kr">implements</span> <span class="nx">HandleResponse</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">@Parameter</span><span class="p">({</span> <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;Success msg&quot;</span><span class="p">,</span> <span class="nx">pattern</span><span class="o">:</span> <span class="s2">&quot;@any&quot;</span> <span class="p">})</span>
    <span class="kr">public</span> <span class="nx">msg</span>: <span class="kt">string</span><span class="p">;</span>

    <span class="kr">public</span> <span class="nx">handle</span><span class="p">(</span> <span class="kd">@ParseJson</span> <span class="nx">response</span>: <span class="kt">Response</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">EventPlan</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChannelAddress</span><span class="p">(</span><span class="s2">&quot;#random&quot;</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">EventPlan</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">DirectedMessage</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">rand</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Response handlers are declared with the <code class="codehilite"><span class="nx">ResponseHandler</span></code> decorator
and the class must implement the
<code class="codehilite"><span class="nx">handle</span><span class="p">(</span><span class="nx">response</span>: <span class="kt">Response</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">EventPlan</span> <span class="o">|</span> <span class="nx">CommandPlan</span></code> method of the
<code class="codehilite"><span class="nx">HandleResponse</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span></code> interface. When the handler receives a JSON
payload, you can benefit from automatic JSON deserialization into an object by
decorating the response parameter with the <code class="codehilite"><span class="kd">@ParseJson</span></code> decorator,
for example <code class="codehilite"><span class="nx">handle</span><span class="p">(</span><span class="kd">@ParseJson</span> <span class="nx">response</span>: <span class="kt">Response</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">CommandPlan</span></code>.</p>
<p>Response Handlers must also return a plan, just like any handler. However, they
must return the appropriate type of plan for the execution chain in which they
respond. So for an <a href="../event-handlers/">Event Handler</a> they must
return an <code class="codehilite"><span class="nx">EventPlan</span></code>, and for a <a href="./">Command Handler</a>
they must return a <code class="codehilite"><span class="nx">CommandPlan</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">It&rsquo;s all asynchronous</p>
<p>It is important to appreciate that because handlers return plans,
the actions declared in that plan are executed asynchronously. In other
words, plans are just data the Rug runtime knows how to interpret but your
handler cannot invoke those Rugs directly. So it&rsquo;s not safe to make
assumptions about when instructions in a plan will be run, although
it is fair to say that the Atomist platform will do its best to apply them
as soon as possible.</p>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../event-handlers/" title="Event Handlers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Event Handlers
              </span>
            </div>
          </a>
        
        
          <a href="../editors/" title="Editors" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Editors
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 Atomist, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://the-composition.com/" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://github.com/atomist" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/atomist" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.atomist.com/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:"../../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-74966852-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>