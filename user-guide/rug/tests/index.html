
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Atomist Developer Platform">
      
      
      
        <meta name="author" content="The Atomist Team">
      
      
        <link rel="shortcut icon" href="../../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Tests - The Atomist Documentation</title>
      
    
    
      <script src="../../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../../.." title="The Atomist Documentation" class="md-logo md-header-nav__button">
            <img src="../../../images/atomist-logo-horiz-reversed.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  User Guide
                </span>
              
                <span class="md-header-nav__parent">
                  Rug
                </span>
              
            
            Tests
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/atomist/rug" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Rug
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../../images/atomist-logo-horiz-reversed.svg">
      </i>
    
    The Atomist Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/atomist/rug" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Rug
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../capabilities/" title="Capabilities" class="md-nav__link">
      Capabilities
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/slack/" title="Connect Atomist to Slack" class="md-nav__link">
      Connect Atomist to Slack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/github/" title="Connect Atomist to GitHub" class="md-nav__link">
      Connect Atomist to GitHub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Connect Atomist to CI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Connect Atomist to CI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/ci/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/travis-ci/" title="Travis CI" class="md-nav__link">
      Travis CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/bot/" title="Atomist Bot" class="md-nav__link">
      Atomist Bot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/what-next/" title="What next" class="md-nav__link">
      What next
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/setup-cli/" title="Setup Rug CLI" class="md-nav__link">
      Setup Rug CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/create-rug-project/" title="Create Rug Project" class="md-nav__link">
      Create Rug Project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/setup-typescript/" title="Setup TypeScript" class="md-nav__link">
      Setup TypeScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/publish-rug-project/" title="Publish Rug Project" class="md-nav__link">
      Publish Rug Project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/add-bot-command/" title="Add Bot Command" class="md-nav__link">
      Add Bot Command
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2" checked>
    
    <label class="md-nav__link" for="nav-4-2">
      Rug
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Rug
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event-handlers/" title="Event Handlers" class="md-nav__link">
      Event Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command-handlers/" title="Command Handlers" class="md-nav__link">
      Command Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../editors/" title="Editors" class="md-nav__link">
      Editors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../generators/" title="Generators" class="md-nav__link">
      Generators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rug-functions/" title="Rug Functions" class="md-nav__link">
      Rug Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/" title="Secrets" class="md-nav__link">
      Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../path-expressions/" title="Path Expressions" class="md-nav__link">
      Path Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microgrammars/" title="Microgrammars" class="md-nav__link">
      Microgrammars
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templates/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Tests
      </label>
    
    <a href="./" title="Tests" class="md-nav__link md-nav__link--active">
      Tests
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#approach" title="Approach" class="md-nav__link">
    Approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-overview" title="Quick overview" class="md-nav__link">
    Quick overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worlds" title="Worlds" class="md-nav__link">
    Worlds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" title="Setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handler-setup" title="Handler setup" class="md-nav__link">
    Handler setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-setup" title="Project setup" class="md-nav__link">
    Project setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution" title="Execution" class="md-nav__link">
    Execution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triggering-command-handlers" title="Triggering command handlers" class="md-nav__link">
    Triggering command handlers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-events" title="Sending events" class="md-nav__link">
    Sending events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-projects" title="Modifying projects" class="md-nav__link">
    Modifying projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure" title="Failure" class="md-nav__link">
    Failure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assertions" title="Assertions" class="md-nav__link">
    Assertions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handler-assertions" title="Handler assertions" class="md-nav__link">
    Handler assertions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-assertions" title="Project assertions" class="md-nav__link">
    Project assertions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rug-parameters" title="Rug parameters" class="md-nav__link">
    Rug parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#well-known-steps" title="Well-known steps" class="md-nav__link">
    Well-known steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-hints" title="Debugging hints" class="md-nav__link">
    Debugging hints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#not-currently-supported" title="Not currently supported" class="md-nav__link">
    Not currently supported
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-directions" title="Future directions" class="md-nav__link">
    Future directions
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../projects/" title="Projects" class="md-nav__link">
      Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../archives/" title="Archives" class="md-nav__link">
      Archives
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lifecycle/" title="Lifecycle" class="md-nav__link">
      Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime/" title="Runtime" class="md-nav__link">
      Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conventions/" title="Conventions" class="md-nav__link">
      Conventions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/slack/" title="Slack" class="md-nav__link">
      Slack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/github/" title="GitHub.com" class="md-nav__link">
      GitHub.com
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/travis-ci/" title="Travis CI" class="md-nav__link">
      Travis CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Interfaces
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Interfaces
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/bot/" title="Bot" class="md-nav__link">
      Bot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-3" type="checkbox" id="nav-4-4-3">
    
    <label class="md-nav__link" for="nav-4-4-3">
      CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-3">
        CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/using-rugs/" title="Using Rugs" class="md-nav__link">
      Using Rugs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../interfaces/cli/developing-rugs/" title="Developing Rugs" class="md-nav__link">
      Developing Rugs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fingerprints/" title="Fingerprints" class="md-nav__link">
      Fingerprints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../seeds/" title="Seeds" class="md-nav__link">
      Seeds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../spring-agent/" title="Spring Agent" class="md-nav__link">
      Spring Agent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-8" type="checkbox" id="nav-4-8">
    
    <label class="md-nav__link" for="nav-4-8">
      Permissions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-8">
        Permissions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../permissions/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permissions/slack/" title="Slack Scopes" class="md-nav__link">
      Slack Scopes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permissions/github/" title="GitHub Scopes" class="md-nav__link">
      GitHub Scopes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Reference Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Rug
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Rug
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug/extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug/path-expressions/" title="Path Expressions" class="md-nav__link">
      Path Expressions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/rug-cli/" title="Rug CLI" class="md-nav__link">
      Rug CLI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#approach" title="Approach" class="md-nav__link">
    Approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-overview" title="Quick overview" class="md-nav__link">
    Quick overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worlds" title="Worlds" class="md-nav__link">
    Worlds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" title="Setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handler-setup" title="Handler setup" class="md-nav__link">
    Handler setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-setup" title="Project setup" class="md-nav__link">
    Project setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution" title="Execution" class="md-nav__link">
    Execution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#triggering-command-handlers" title="Triggering command handlers" class="md-nav__link">
    Triggering command handlers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-events" title="Sending events" class="md-nav__link">
    Sending events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-projects" title="Modifying projects" class="md-nav__link">
    Modifying projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure" title="Failure" class="md-nav__link">
    Failure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assertions" title="Assertions" class="md-nav__link">
    Assertions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handler-assertions" title="Handler assertions" class="md-nav__link">
    Handler assertions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-assertions" title="Project assertions" class="md-nav__link">
    Project assertions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rug-parameters" title="Rug parameters" class="md-nav__link">
    Rug parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#well-known-steps" title="Well-known steps" class="md-nav__link">
    Well-known steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-hints" title="Debugging hints" class="md-nav__link">
    Debugging hints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#not-currently-supported" title="Not currently supported" class="md-nav__link">
    Not currently supported
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-directions" title="Future directions" class="md-nav__link">
    Future directions
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Tests</h1>
                
                <p>Rug provides a testing framework based
on <a href="https://en.wikipedia.org/wiki/Behavior-driven_development" title="Behavior-Driven Development">Behavior-Driven Development (BDD)</a> concepts.  This allows
rapid, in-memory testing of Rugs.</p>
<p>The framework is based on the well known <a href="https://cucumber.io/docs/reference" title="Gherkin BDD">Gherkin BDD DSL</a>
and inspired by solutions built on it, such
as <a href="https://github.com/cucumber/cucumber-js" title="Cucumber.js">cucumber-js</a>.  All logic is coded in TypeScript or
JavaScript. If you are familiar with Cucumber (versions of which exist
for many languages), you should find the Rug test framework
particularly easy to learn; if not, it should still be intuitive.</p>
<h2 id="approach">Approach<a class="headerlink" href="#approach" title="Permanent link">&para;</a></h2>
<p>Rug is designed to support <a href="https://en.wikipedia.org/wiki/Test-driven_development" title="Test-Driven Development">Test Driven Development</a> using unit
tests and BDD.  We recommend following the &ldquo;red &rarr; green &rarr;
refactor&rdquo; approach.</p>
<div class="admonition missing">
<p class="admonition-title">Prerequisites</p>
<p>You will need the <a href="../../interfaces/cli/install/" title="Rug CLI Installation">Rug CLI</a> and <a href="https://nodejs.org/" title="Node.js">Node.js</a>
installed to run tests.</p>
</div>
<p>For unit testing, we recommend using the <a href="https://mochajs.org/" title="Mocha.js">Mocha</a> framework
with <a href="https://github.com/power-assert-js/power-assert" title="JavaScript Power Assert">Power Assert</a>.  You should put your Mocha unit
tests in the <code>.atomist/mocha</code> directory to avoid conflicts with where
the Rug CLI looks for the BDD tests.  With this setup, your
<code>.atomist/package.json</code> would look something like this:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@atomist/rugs&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.0.0-m.4&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@types/mocha&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.2.40&quot;</span><span class="p">,</span>
    <span class="nt">&quot;@types/power-assert&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.4.29&quot;</span><span class="p">,</span>
    <span class="nt">&quot;espower-typescript&quot;</span><span class="p">:</span> <span class="s2">&quot;^8.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mocha&quot;</span><span class="p">:</span> <span class="s2">&quot;^3.2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;power-assert&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.4.2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;tslint&quot;</span><span class="p">:</span> <span class="s2">&quot;^5.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;typescript&quot;</span><span class="p">:</span> <span class="s2">&quot;2.3.2&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;directories&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;mocha&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;lint&quot;</span><span class="p">:</span> <span class="s2">&quot;tslint &#39;**/*.ts&#39; --exclude &#39;node_modules/**&#39; -t verbose&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mocha&quot;</span><span class="p">:</span> <span class="s2">&quot;mocha --compilers ts:espower-typescript/guess &#39;mocha/**/*.ts&#39;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;npm run mocha &amp;&amp; rug test&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>and you can run your unit tests with the following command:</p>
<div class="codehilite"><pre><span></span><span class="gp">$</span> <span class="o">(</span> <span class="nb">cd</span> .atomist <span class="o">&amp;&amp;</span> npm run mocha <span class="o">)</span>
</pre></div>

<p>or run both the unit and BDD tests with this command:</p>
<div class="codehilite"><pre><span></span><span class="gp">$</span> <span class="o">(</span> <span class="nb">cd</span> .atomist <span class="o">&amp;&amp;</span> npm <span class="nb">test</span> <span class="o">)</span>
</pre></div>

<p>The documentation for <a href="https://mochajs.org/" title="Mocha.js">Mocha</a> and <a href="https://github.com/power-assert-js/power-assert" title="JavaScript Power Assert">Power Assert</a>
can help you get started with unit testing in TypeScript/JavaScript.
The rest of this document focuses on Rug BDD testing.</p>
<h2 id="quick-overview">Quick overview<a class="headerlink" href="#quick-overview" title="Permanent link">&para;</a></h2>
<p>Before taking a deeper dive into the Rug BDD approach, let&rsquo;s look at
an example.</p>
<p>Consider the following simple editor that will rename a Java file.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">EditProject</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@atomist/rug/operations/ProjectEditor&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Editor</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@atomist/rug/operations/Decorators&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@atomist/rug/model/Core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">PathExpressionEngine</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@atomist/rug/tree/PathExpression&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">JavaClass</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@atomist/rug/model/JavaClass&#39;</span><span class="p">;</span>

<span class="kd">@Editor</span><span class="p">(</span><span class="s2">&quot;Renamer&quot;</span><span class="p">,</span> <span class="s2">&quot;Renames Java class&quot;</span><span class="p">)</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">Renamer</span> <span class="p">{</span>

    <span class="nx">edit</span><span class="p">(</span><span class="nx">project</span>: <span class="kt">Project</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">eng</span> <span class="o">=</span> <span class="nx">project</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">pathExpressionEngine</span><span class="p">;</span>
        <span class="nx">eng</span><span class="p">.</span><span class="kd">with</span><span class="o">&lt;</span><span class="nx">JavaClass</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">project</span><span class="p">,</span> <span class="s2">&quot;//JavaClass()[@name=&#39;Dog&#39;]&quot;</span><span class="p">,</span> <span class="nx">jc</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">jc</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="s2">&quot;Cat&quot;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>We want to test that the editor works as intended.  First, we write a
Gherkin <code>.feature</code> file that is an easily readable description of the
behaviors we expect.  We&rsquo;ll name the file <code>Renaming.feature</code> and place it
under <code>.atomist/tests/project</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">Feature:</span><span class="nf"> Renaming a Java file</span>
<span class="nf">  We should be able to rename Java files.</span>
<span class="nf">  Specifically, we should be able to rename</span>
<span class="nf">  dog files into cat files.</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Dogs can be turned into cats</span>
<span class="k">    Given </span><span class="nf">a file named src/main/java/Dog.java</span>
<span class="nf">    </span><span class="k">When </span><span class="nf">edit with Renamer</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">there should be one file</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">the file is now src/main/java/Cat.java</span>
</pre></div>

<p>Walking through this definition:</p>
<ul>
<li>The syntax is standard Gherkin.  It is human-readable and contains
    a specification of the desired behavior, but not how that behavior
    is to be verified.</li>
<li>A Gherkin <em>feature</em> can contain one or more <em>scenarios</em>. You can
    include as many feature files in the <code>.atomist/tests/project</code>
    directory as you like.</li>
<li>Each scenario is typically broken down into three blocks of
    <em>given</em>, <em>when</em>, and <em>then</em> steps, following the BDD style.
    Typically there is a single <em>when</em> step&ndash;the execution of a Rug.
    There are often multiple <em>given</em> and <em>then</em> steps.  <em>Then</em> steps
    are assertions, and it is good practice to break them up for
    clarity, so failures are specific.</li>
</ul>
<div class="admonition danger">
<p>The Rug Gherkin parser does not support the <code>And</code> keyword.  Just
use the appropriate step keyword multiple times.</p>
</div>
<p>We now have a clear specification of the desired behavior.  How does
the test infrastructure know how to execute these steps?</p>
<p>As in <em>cucumber-js</em>, we delegate to JavaScript or TypeScript to
execute these steps.  In keeping with our general preference for
TypeScript, let&rsquo;s see the TypeScript steps corresponding to the above
feature:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">ProjectScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">Given</span><span class="p">(</span><span class="s2">&quot;a file named src/main/java/Dog.java&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">addFile</span><span class="p">(</span><span class="s2">&quot;src/main/java/Dog.java&quot;</span><span class="p">,</span> <span class="s2">&quot;public class Dog {}&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;edit with Renamer&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ProjectScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">editor</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">editor</span><span class="p">(</span><span class="s2">&quot;Renamer&quot;</span><span class="p">);</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">editWith</span><span class="p">(</span><span class="nx">editor</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;there should be one file&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">totalFileCount</span><span class="p">()</span> <span class="o">===</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the file is now src/main/java/Cat.java&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileExists</span><span class="p">(</span><span class="s2">&quot;src/main/java/Cat.java&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>We start by importing Rug modules needed for testing, namely
<code class="codehilite"><span class="nx">Project</span></code>, the core test functions <code class="codehilite"><span class="nx">Given</span></code>,
<code class="codehilite"><span class="nx">When</span></code>, and <code class="codehilite"><span class="nx">Then</span></code>, and the testing module
<code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code>, which provides the context in
which each scenario runs.</p>
<p>Step definitions are linked to the steps in the feature via strings,
such as <code class="codehilite"><span class="s2">&quot;a file named src/main/java/Dog.java&quot;</span></code>.  The
first argument for each type of step is a string that should match the
string after the same step type in the feature file.  The second
argument is a function, i.e., callback, that implements the step.
This step-implementing function takes two arguments.  The first
argument is a <code class="codehilite"><span class="nx">Project</span></code> object and the second optional
argument is a <code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code>.  You can see only
the <code class="codehilite"><span class="nx">When</span></code> step uses the optional second argument, so it
is the only one that declares it (see below for more details
on <a href="#worlds">worlds</a>).  Step definitions may be provided in any
TypeScript or JavaScript file under <code>.atomist/tests/project</code>. They
will be loaded automatically by the test infrastructure.</p>
<p>Different scenarios and even different features may share step
definitions.  This is beneficial in the case of common steps, e.g.,
<code class="codehilite"><span class="k">Given </span><span class="nf">an empty archive</span></code>, which can be shared across many
features and scenarios.</p>
<h2 id="worlds">Worlds<a class="headerlink" href="#worlds" title="Permanent link">&para;</a></h2>
<p>As mentioned briefly above, each scenario has a <em>world</em> in which it
executes.  A <em>world</em> is an isolated context for each scenario
execution that allows you to control how your Rug is being tested and
how the results of the tests are evaluated.  The scenario&rsquo;s world is
encapsulated in the TypeScript <code class="codehilite"><span class="nx">ScenarioWorld</span></code> interface
and made available to the functions implementing each step in the
scenario.  The modifications made to the scenario&rsquo;s world in each step
is visible to all subsequent steps in the scenario.  So the scenario&rsquo;s
world is, more or less, the <em>state</em> of the scenario at each step.</p>
<p>The type of world made available to each scenario depends on what is
being tested.  When testing handlers, the world provided to the
functions implementing the steps is a derivative of <code class="codehilite"><span class="nx">HandlerScenarioWorld</span></code>.  <code class="codehilite"><span class="nx">HandlerScenarioWorld</span></code> extends
<code class="codehilite"><span class="nx">ScenarioWorld</span></code>, adding handler-specific methods such as
the ability to verify created plans.  The handler scenario world is
the first argument to all the functions implementing the handler
scenario steps.  For example, the declaration for the <code class="codehilite"><span class="nx">When</span></code> function is effectively:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">HandlerScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">When</span><span class="p">(</span><span class="nx">s</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">HandlerScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">);</span>
</pre></div>

<p>When testing Rugs that deal with projects, e.g., generators and
editors, the world provided to the function implementing the scenario
steps is a <code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code>.  The <code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code> interface extends <code class="codehilite"><span class="nx">ScenarioWorld</span></code>,
adding functions to find and execute editors and generators, query the
number of modifications made, and see if editing succeeded.  The
scenario world is an optional second parameter to the function that
implements each scenario step.  For example, the declaration of the
<code class="codehilite"><span class="nx">Given</span></code> function is effectively:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">ProjectScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">Given</span><span class="p">(</span><span class="nx">s</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">Project</span><span class="p">,</span> <span class="nx">ProjectScenarioWorld</span><span class="o">?</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">);</span>
</pre></div>

<p>In practice, what you do with the scenario&rsquo;s world depends on what
<em>phase</em> of the scenario you are in.  Each BDD testing scenario has
three phases, mapping directly to the different types of Gherkin
steps:</p>
<ol>
<li><a href="#setup">Setup</a>: the <code class="codehilite"><span class="nf">Given</span></code> steps are used to set up
    testing prerequisites within the world</li>
<li><a href="#execution">Execution</a>: the action being tested is executed on
    the world in the <code class="codehilite"><span class="nf">When</span></code> step</li>
<li><a href="#assertions">Assertions</a>: the state of the scenario&rsquo;s world is
    interrogated in the <code class="codehilite"><span class="nf">Then</span></code> steps</li>
</ol>
<p>In the following sections, we will delve into each of these phases and
describe in detail how the scenario&rsquo;s world can be used in each phase
to enable testing.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>The <code class="codehilite"><span class="nf">Given</span></code> step is used to set up a world for a testing
scenario.  Many testing scenarios can be entirely setup using
a <a href="#well-known-steps" title="Well-Known BDD Steps">&ldquo;well-known step&rdquo;</a>, but sometimes you need to customize
for your particular scenario.</p>
<h3 id="handler-setup">Handler setup<a class="headerlink" href="#handler-setup" title="Permanent link">&para;</a></h3>
<p>When testing command handlers, you almost always use the &ldquo;nothing&rdquo;
well-known step that, as you might expect, does nothing.</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">nothing</span>
</pre></div>

<p>As with all well-known steps, you do not need to supply an
implementation, one is already available to the BDD tests by Rug.</p>
<p>To avoid unwanted side effects during testing, the testing framework
will only consider executing event handlers that are explicitly
registered within a scenario.  Thus, the setup for event handler
testing typically involves registering the event handler being tested
in the <code class="codehilite"><span class="nf">Given</span></code> step.  The following Gherkin step:</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">HandlerToTest is registered</span>
</pre></div>

<p>could be implemented using the following TypeScript function:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">EventHandlerScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">Given</span><span class="p">(</span><span class="s2">&quot;HandlerToTest is registered&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">EventHandlerScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s2">&quot;HandlerToTest&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The event handler is looked up by name using the <code class="codehilite"><span class="nx">registerHandler</span></code> method of <code class="codehilite"><span class="nx">EventHandlerScenarioWorld</span></code>,
which extends <code class="codehilite"><span class="nx">HandlerScenarioWorld</span></code> with event handler
specific methods.  The name used should be the same as the first
argument to the <code class="codehilite"><span class="kd">@EventHandler</span></code> decorator.  If the
handler cannot be found in the current archive, the test scenario will
fail.</p>
<p>Since this is so common, there is a well-known step for it.</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">HandlerToTest handler</span>
</pre></div>

<p>The above step in a feature file will register the &ldquo;HandlerToTest&rdquo;
event handler for a scenario.  You do not need to supply an
implementation.</p>
<h3 id="project-setup">Project setup<a class="headerlink" href="#project-setup" title="Permanent link">&para;</a></h3>
<p>When testing generators you typically start with an empty project,
which is provided as a well-known step.</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">an empty project</span>
</pre></div>

<p>Customizations when testing editors typically involve a series of
steps, each creating a file to populate the project for testing.  As
an example, consider the <code class="codehilite"><span class="nf">Given</span></code> steps below.</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">a project POM</span>
<span class="k">Given </span><span class="nf">a Java source file</span>
</pre></div>

<p>These steps could be implemented with the following TypeScript
functions.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Given</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">Given</span><span class="p">(</span><span class="s2">&quot;a project POM&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">addFile</span><span class="p">(</span><span class="s2">&quot;pom.xml&quot;</span><span class="p">,</span> <span class="sb">`&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="sb">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span>
<span class="sb">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
<span class="sb">    &lt;groupId&gt;atomist&lt;/groupId&gt;</span>
<span class="sb">    &lt;artifactId&gt;ruggery&lt;/artifactId&gt;</span>
<span class="sb">    &lt;version&gt;0.1.0-SNAPSHOT&lt;/version&gt;</span>
<span class="sb">&lt;/project&gt;</span>
<span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">Given</span><span class="p">(</span><span class="s2">&quot;a Java source file&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">addFile</span><span class="p">(</span><span class="s2">&quot;src/main/java/Some.java&quot;</span><span class="p">,</span> <span class="sb">`public class Some {}`</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>There are also well-known steps for populating the project to be
tested with the contents of the Rug project itself.  The first copies
the entire contents of the Rug project, including the <code>.atomist</code>
directory, into the project being used in the test.</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">the archive root</span>
</pre></div>

<p>The second form copies everything <em>but</em> the <code>.atomist</code> directory into
the project being used in the test.</p>
<div class="codehilite"><pre><span></span><span class="k">Given </span><span class="nf">archive non Atomist content</span>
</pre></div>

<h2 id="execution">Execution<a class="headerlink" href="#execution" title="Permanent link">&para;</a></h2>
<p>For each scenario there is typically one <code class="codehilite"><span class="nf">When</span></code> step
triggering a single action, sending an event or invoking a command
handler, editor, or generator.</p>
<h3 id="triggering-command-handlers">Triggering command handlers<a class="headerlink" href="#triggering-command-handlers" title="Permanent link">&para;</a></h3>
<p>A command handler is typically triggered from within chat by someone
sending the Atomist Bot a message with the command handler&rsquo;s intent.
To simulate this action in the testing framework, you use the
<code class="codehilite"><span class="nx">invokeHandler</span></code> method.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">CommandHandlerScenarioWorld</span><span class="p">,</span> <span class="nx">When</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;the TestCommandHandler is invoked&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">CommandHandlerScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">commandHandler</span><span class="p">(</span><span class="s2">&quot;TestCommandHandler&quot;</span><span class="p">);</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">invokeHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">});</span>
</pre></div>

<p>The <code class="codehilite"><span class="nx">CommandHandlerScenarioWorld</span></code> interface used above
inherits from <code class="codehilite"><span class="nx">HandlerScenarioWorld</span></code>, adding methods
specific to command handlers.  Before invoking the command handler,
you use the <code class="codehilite"><span class="nx">CommandHandlerScenarioWorld</span></code> object to
lookup the handler by name using the <code class="codehilite"><span class="nx">commandHandler</span></code>
method.  The name you provide is the same as the name used in the
<code class="codehilite"><span class="kd">@CommandHandler</span></code> decorator.</p>
<h3 id="sending-events">Sending events<a class="headerlink" href="#sending-events" title="Permanent link">&para;</a></h3>
<p>To simulate an event occurring when testing an event handler, you
first create the appropriate <a href="../path-expressions/#cortex-graph">event object</a> from the classes
in the <code>cortex/stub</code> directory.  Then, you use the <code>sendEvent</code> method
of <code class="codehilite"><span class="nx">EventHandlerScenarioWorld</span></code> to trigger the receipt of
that event.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">stub</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/cortex/stub/Types&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">EventHandlerScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;a new Tag is received&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">EventHandlerScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">Tag</span><span class="p">();</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">sendEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Remember that you must have registered an event handler that responds
to that exact kind of event.  You can create arbitrarily complex
events using the &ldquo;stub&rdquo; objects.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">stub</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/cortex/stub/Types&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">EventHandlerScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;an initial commit is received&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">EventHandlerScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">Push</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">addCommits</span><span class="p">(</span><span class="k">new</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">Commit</span><span class="p">().</span><span class="nx">withMessage</span><span class="p">(</span><span class="s2">&quot;initial commit by Atomist&quot;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">withRepo</span><span class="p">(</span><span class="k">new</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">Repo</span><span class="p">().</span><span class="nx">withName</span><span class="p">(</span><span class="nx">repoName</span><span class="p">).</span><span class="nx">withOwner</span><span class="p">(</span><span class="nx">orgName</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">withOrg</span><span class="p">(</span><span class="k">new</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">Org</span><span class="p">().</span><span class="nx">withOwner</span><span class="p">(</span><span class="nx">orgName</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">withChatTeam</span><span class="p">(</span><span class="k">new</span> <span class="nx">stub</span><span class="p">.</span><span class="nx">ChatTeam</span><span class="p">().</span><span class="nx">withId</span><span class="p">(</span><span class="s2">&quot;NONESUCH&quot;</span><span class="p">).</span><span class="nx">withName</span><span class="p">(</span><span class="s2">&quot;chatter&quot;</span><span class="p">).</span><span class="nx">withProvider</span><span class="p">(</span><span class="s2">&quot;Slack&quot;</span><span class="p">))));</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">sendEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h3 id="modifying-projects">Modifying projects<a class="headerlink" href="#modifying-projects" title="Permanent link">&para;</a></h3>
<p>The &ldquo;Quick Overview&rdquo; example above showed how the <code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code> is used to look up and execute an editor.  The
approach is similar for generators.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">ProjectScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;project generated&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ProjectScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">generator</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">generator</span><span class="p">(</span><span class="s2">&quot;SomeGenerator&quot;</span><span class="p">);</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">generateWith</span><span class="p">(</span><span class="nx">generator</span><span class="p">,</span> <span class="s2">&quot;new-project&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">param1</span><span class="o">:</span> <span class="s2">&quot;value1&quot;</span> <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>The generator is looked up by name using the <code>generator</code> method on
<code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code>, providing the same name used as
the first argument to the <code class="codehilite"><span class="kd">@Generator</span></code> decorator.  The
generator is executed using the <code>generateWith</code> method.  The
<code>generateWith</code> method takes three arguments: the generator, the name
of the project to be generated, and a JavaScript object whose keys are
the names of the generator parameters and whose values are the values
of those parameters.</p>
<h3 id="failure">Failure<a class="headerlink" href="#failure" title="Permanent link">&para;</a></h3>
<p>If you want to simulate failure or discover in your <code class="codehilite"><span class="nf">Where</span></code>
step that your world is in an invalid state, the <code class="codehilite"><span class="nx">ScenarioWorld</span></code> interface provides a method to abort the scenario.  If
you are testing handlers, using the <code class="codehilite"><span class="nx">abort</span></code> method would
look like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">ScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/ScenarioWorld&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">When</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;the scenario aborts&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">ScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If you are testing editors and generators, it would look like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/ScenarioWorld&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">When</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;the scenario aborts&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The result of the above steps would be that the scenario is marked as
aborted, meaning that subsequent steps, aside from a test to see if
the scenario aborted, will not be attempted and marked as failed.</p>
<h2 id="assertions">Assertions<a class="headerlink" href="#assertions" title="Permanent link">&para;</a></h2>
<p>The <code class="codehilite"><span class="nf">Then</span></code> steps consist of one or more assertions about the
final state of the scenario world.  The <code class="codehilite"><span class="nx">Then</span></code>
implementation should return either <code class="codehilite"><span class="kr">boolean</span></code> or
<code class="codehilite"><span class="k">void</span></code>.  It is good practice for each step to be
fine-grained, containing only a single assertion, so that reports are
maximally informative about what succeeded and failed.  The code of
each failed assertion will be available in the test report provided by
the Rug CLI.</p>
<p>The <code class="codehilite"><span class="nx">ScenarioWorld</span></code> interface provides methods for
checking if parameters passed to a Rug were valid and checking if a
scenario aborted, e.g., if a Rug throws an <code class="codehilite"><span class="nb">Error</span></code>.  The
example below shows how to use each of these methods in a handler
scenario <code class="codehilite"><span class="nf">Then</span></code> step.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">ScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/ScenarioWorld&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Then</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the parameters were valid&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">ScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">w</span><span class="p">.</span><span class="nx">invalidParameters</span><span class="p">()</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;it aborted&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">w</span>: <span class="kt">ScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">w</span><span class="p">.</span><span class="nx">aborted</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The code would look similar for editor and generator scenario
<code class="codehilite"><span class="nf">Then</span></code> steps, except that you would import <code class="codehilite"><span class="nx">Then</span></code> from <code>@atomist/rug/test/project/Core</code> and each callback would
accept the arguments <code class="codehilite"><span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ScenarioWorld</span><span class="p">)</span></code>.
But it is probably easier to use the well-known steps when testing
editors and generators.</p>
<div class="codehilite"><pre><span></span><span class="k">Then </span><span class="nf">parameters were valid</span>
<span class="k">Then </span><span class="nf">parameters were invalid</span>
<span class="k">Then </span><span class="nf">the scenario aborted</span>
</pre></div>

<h3 id="handler-assertions">Handler assertions<a class="headerlink" href="#handler-assertions" title="Permanent link">&para;</a></h3>
<p>Handlers return a <code class="codehilite"><span class="nx">Plan</span></code> object, which is simply a data
structure.  You can easily examine them, checking messages and
instructions as appropriate.  For messages, you can check their
content and addressing.  For instructions, you can check if they are
of the right kind, are calling the right Rug, and have the proper
response handlers.  A JavaScript assertion framework such
as <a href="http://chaijs.com/" title="Chai.js">Chai</a> can help.  You can get the plan returned by a handler
using the <code>plan</code> method on <code class="codehilite"><span class="nx">HandlerScenarioWorld</span></code>.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">DirectedMessage</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/operations/Handlers&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">EventHandlerScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/handler/Core&quot;</span><span class="p">;</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the event handler should respond with the correct message&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">w</span>: <span class="kt">EventHandlerScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">expected</span> <span class="o">=</span> <span class="s2">&quot;the message&quot;</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">plan</span><span class="p">().</span><span class="nx">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="kr">as</span> <span class="nx">DirectedMessage</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nx">body</span> <span class="o">===</span> <span class="nx">expected</span>
            <span class="o">&amp;&amp;</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channelNames</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span>
            <span class="o">&amp;&amp;</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channelNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;#some-channel&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">);</span>
</pre></div>

<p>The above example is for an event handler and uses <code class="codehilite"><span class="nx">EventHandlerScenarioWorld</span></code>, which extends <code class="codehilite"><span class="nx">HandlerScenarioWorld</span></code>, as the callback argument type.</p>
<h3 id="project-assertions">Project assertions<a class="headerlink" href="#project-assertions" title="Permanent link">&para;</a></h3>
<p>When testing editors and generators, the callback provided as the
second argument to the <code class="codehilite"><span class="nx">Then</span></code> accepts a <code class="codehilite"><span class="nx">Project</span></code> and optional <code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code>.  A typical
assertion for a generator will assert that files will be created and
have the appropriate content.  The feature file might look like</p>
<div class="codehilite"><pre><span></span><span class="k">Then </span><span class="nf">the README exists</span>
<span class="k">Then </span><span class="nf">the README contains the project name</span>
<span class="k">Then </span><span class="nf">the class source file exists</span>
<span class="k">Then </span><span class="nf">the class source file contains the class name</span>
</pre></div>

<p>and those steps would be implemented</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Then</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the README exists&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileExists</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the README contains the project name&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileContains</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">());</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the class source file exists&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileExists</span><span class="p">(</span><span class="s2">&quot;src/main/java/Sugar.java&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the class source file contains the class name&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;Sugar&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileContains</span><span class="p">(</span><span class="s2">&quot;src/main/java/Sugar.java&quot;</span><span class="p">,</span> <span class="sb">`class </span><span class="si">${</span><span class="nx">className</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Testing that a file exists and that a file has certain contents are so
common that well-known steps are provided for these assertions.</p>
<div class="codehilite"><pre><span></span><span class="k">Then </span><span class="nf">file at some/path/to/file.txt should exist</span>
<span class="k">Then </span><span class="nf">file at some/path/to/file.txt should contain something of interest</span>
</pre></div>

<p>The first step asserts that the file <code>some/path/to/file.txt</code> exists
while the second asserts that the file contains the literal string
<code>something of interest</code>.</p>
<p>The <code class="codehilite"><span class="nx">ProjectScenarioWorld</span></code> interface provides the
following methods to test the outcome of running an <em>editor</em>.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Then</span><span class="p">,</span> <span class="nx">ProjectScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;some changes were made&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ProjectScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">w</span><span class="p">.</span><span class="nx">modificationsMade</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the editor failed&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ProjectScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">w</span><span class="p">.</span><span class="nx">failed</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<div class="admonition caution">
<p class="admonition-title">For editors only</p>
<p>The <code class="codehilite"><span class="nx">modificationsMade</span></code> and <code class="codehilite"><span class="nx">failed</span></code>
methods only consider editor operations.  They do not return
meaningful results when testing generators.</p>
</div>
<p>There are well-known steps to make using the above methods easier.</p>
<div class="codehilite"><pre><span></span><span class="k">Then </span><span class="nf">changes were made</span>
<span class="k">Then </span><span class="nf">it should fail</span>
</pre></div>

<h2 id="rug-parameters">Rug parameters<a class="headerlink" href="#rug-parameters" title="Permanent link">&para;</a></h2>
<p>If the Rug you are testing takes parameters, you pass them in as an
object whose property names are the parameter names.  For example,
with the <code class="codehilite"><span class="nx">ProjectWorld</span><span class="p">.</span><span class="nx">editWith</span></code> function the parameter
object is passed as the second argument.  If the <code>AlpEditor</code> being
tested below takes a single parameter named <code>heir</code>, you would set its
value to <code class="codehilite"><span class="s2">&quot;Paul&quot;</span></code> like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">ProjectScenarioWorld</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>

<span class="nx">When</span><span class="p">(</span><span class="s2">&quot;politics takes its course&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">w</span>: <span class="kt">ProjectScenarioWorld</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">editWith</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">editor</span><span class="p">(</span><span class="s2">&quot;AlpEditor&quot;</span><span class="p">),</span> <span class="p">{</span><span class="nx">heir</span><span class="o">:</span> <span class="s2">&quot;Paul&quot;</span><span class="p">});</span>
<span class="p">});</span>
</pre></div>

<h2 id="well-known-steps">Well-known steps<a class="headerlink" href="#well-known-steps" title="Permanent link">&para;</a></h2>
<p>A &ldquo;well-known step&rdquo; is a named step that the Rug testing framework
defines for you.  You can refer to the step in the
feature file but do not have to define it in the steps file. Here are the
well-known steps available in handler scenarios.</p>
<table>
<thead>
<tr>
<th>Step Type</th>
<th>Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>Given</td>
<td><code>nothing</code></td>
<td>A cold, empty world</td>
</tr>
<tr>
<td>Given</td>
<td><code>SomeHandler handler</code></td>
<td>The event handler <code>SomeHandler</code> is registered</td>
</tr>
<tr>
<td>Then</td>
<td><code>no handler fired</code></td>
<td>The <code class="codehilite"><span class="nx">Plan</span></code> is <code class="codehilite"><span class="kc">null</span></code></td>
</tr>
<tr>
<td>Then</td>
<td><code>handler parameters were valid</code></td>
<td>The parameters passed to the Rug were valid</td>
</tr>
<tr>
<td>Then</td>
<td><code>handler parameters were invalid</code></td>
<td>The parameters passed to the Rug were not valid</td>
</tr>
<tr>
<td>Then</td>
<td><code>plan has no messages</code></td>
<td>The <code class="codehilite"><span class="nx">Plan</span></code> has no messages (it could still have instructions)</td>
</tr>
</tbody>
</table>
<p>Here are the well-known steps available in project scenarios.</p>
<table>
<thead>
<tr>
<th>Step Type</th>
<th>Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>Given</td>
<td><code>an empty project</code></td>
<td>An empty project, useful for generators</td>
</tr>
<tr>
<td>Given</td>
<td><code>the archive root</code></td>
<td>The entire contents of the Rug archive providing the Rug being tested, including the <code>.atomist</code> directory</td>
</tr>
<tr>
<td>Given</td>
<td><code>archive non Atomist content</code></td>
<td>The contents of the Rug archive providing the Rug being tested, excluding the <code>.atomist</code> directory</td>
</tr>
<tr>
<td>Given</td>
<td><code>github someone/somerepo</code></td>
<td>The <code class="codehilite"><span class="nx">Project</span></code> object made available to test steps will be the contents of the master branch of the GitHub.com <code>someone/somerepo</code> repository</td>
</tr>
<tr>
<td>Given</td>
<td><code>github someone/somerepo/somebranch</code></td>
<td>The <code class="codehilite"><span class="nx">Project</span></code> object made available to test steps will be the contents of the <code>somebranch</code> branch of the GitHub.com <code>someone/somerepo</code> repository</td>
</tr>
<tr>
<td>Then</td>
<td><code>changes were made</code></td>
<td>The <em>editor</em> made changes to the project</td>
</tr>
<tr>
<td>Then</td>
<td><code>no changes were made</code></td>
<td>The <em>editor</em> made no changes to the project</td>
</tr>
<tr>
<td>Then</td>
<td><code>parameters were valid</code></td>
<td>The parameters passed to the Rug were valid</td>
</tr>
<tr>
<td>Then</td>
<td><code>parameters were invalid</code></td>
<td>The parameters passed to the Rug were not valid</td>
</tr>
<tr>
<td>Then</td>
<td><code>file at a/path/to/file should exist</code></td>
<td>The file <code>a/path/to/file</code> exists in the resulting <code class="codehilite"><span class="nx">Project</span></code></td>
</tr>
<tr>
<td>Then</td>
<td><code>file at a/path/to/file should contain blah blah</code></td>
<td>The file <code>a/path/to/file</code> exists in the resulting <code class="codehilite"><span class="nx">Project</span></code> and contains the literal string <code>blah blah</code></td>
</tr>
<tr>
<td>Then</td>
<td><code>it should fail</code></td>
<td>The Rug runtime was unable to complete executing the Rug</td>
</tr>
<tr>
<td>Then</td>
<td><code>the scenario aborted</code></td>
<td>The Rug being executed aborted, typically by throwing an exception</td>
</tr>
</tbody>
</table>
<p>In the unlikely event you want to override a common step definition
provided by Atomist or yourself, you can define the same step in your
step definitions.  Your local definition will take precedence.</p>
<h2 id="debugging-hints">Debugging hints<a class="headerlink" href="#debugging-hints" title="Permanent link">&para;</a></h2>
<p>Sometimes when testing, it is helpful to print out the contents of a
file to help you diagnose why a test is failing.  The Rug testing
framework provides a few helper functions to provide insight to what
changes were made.</p>
<p>To print the entire contents of a project in the test output, use the
<code class="codehilite"><span class="nx">Helpers</span><span class="p">.</span><span class="nx">prettyListFiles</span></code> function as follows:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Then</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">helpers</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Helpers&quot;</span><span class="p">;</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the README exists&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">prettyListFiles</span><span class="p">(</span><span class="nx">p</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileExists</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>To see the contents of a file in the test output, use the
<code class="codehilite"><span class="nx">Helpers</span><span class="p">.</span><span class="nx">dump</span></code> function.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/model/Project&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Then</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Core&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">helpers</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/rug/test/project/Helpers&quot;</span><span class="p">;</span>

<span class="nx">Then</span><span class="p">(</span><span class="s2">&quot;the README exists&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">dump</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="s2">&quot;README.md&quot;</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fileExists</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h2 id="not-currently-supported">Not currently supported<a class="headerlink" href="#not-currently-supported" title="Permanent link">&para;</a></h2>
<p>Rug Test does not yet support the full range of Gherkin functionality.
The following features are missing:</p>
<ul>
<li>Doc strings</li>
<li>Data tables</li>
<li>Tags</li>
</ul>
<p>These may be supported in a future version of Rug.</p>
<h2 id="future-directions">Future directions<a class="headerlink" href="#future-directions" title="Permanent link">&para;</a></h2>
<ul>
<li>The need for more than one source file for each feature is both a
    strength and weakness of Gherkin.  It&rsquo;s a strength because each
    file is in a single, logical, toolable language.  It&rsquo;s a weakness
    because of the level of ceremony required and because of the
    brittle linkage by a string value.  We intend to provide editors
    that helps with this, automatically creating feature files for
    editors, and TypeScript files implementing the steps in feature
    files.</li>
<li>In a future release, BDD testing support will be extended beyond
    project operations to event handlers.</li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../templates/" title="Templates" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Templates
              </span>
            </div>
          </a>
        
        
          <a href="../projects/" title="Projects" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Projects
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 Atomist, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://the-composition.com/" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://github.com/atomist" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/atomist" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.atomist.com/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:"../../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-74966852-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>